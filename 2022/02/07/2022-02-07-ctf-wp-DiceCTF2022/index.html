<!DOCTYPE html><html lang="en" data-theme="dark"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"><title>DiceCTF2022 Write Up | Rec|rEc|reC</title><meta name="keywords" content="RSA,FSR"><meta name="author" content="Rec"><meta name="copyright" content="Rec"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#0d0d0d"><meta name="description" content="DiceCTF2022 假期摸鱼，记录解题思路与复现情况">
<meta property="og:type" content="article">
<meta property="og:title" content="DiceCTF2022 Write Up">
<meta property="og:url" content="https://rechn0.github.io/2022/02/07/2022-02-07-ctf-wp-DiceCTF2022/index.html">
<meta property="og:site_name" content="Rec|rEc|reC">
<meta property="og:description" content="DiceCTF2022 假期摸鱼，记录解题思路与复现情况">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7">
<meta property="article:published_time" content="2022-02-07T06:30:00.000Z">
<meta property="article:modified_time" content="2022-05-05T02:46:42.292Z">
<meta property="article:author" content="Rec">
<meta property="article:tag" content="RSA">
<meta property="article:tag" content="FSR">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7"><link rel="shortcut icon" href="/img/favicon.ico"><link rel="canonical" href="https://rechn0.github.io/2022/02/07/2022-02-07-ctf-wp-DiceCTF2022/"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6/css/all.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  translate: undefined,
  noticeOutdate: undefined,
  highlight: {"plugin":"highlighjs","highlightCopy":false,"highlightLang":true,"highlightHeightLimit":false},
  copy: {
    success: 'Copy successfully',
    error: 'Copy error',
    noSupport: 'The browser does not support'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  date_suffix: {
    just: 'Just',
    min: 'minutes ago',
    hour: 'hours ago',
    day: 'days ago',
    month: 'months ago'
  },
  copyright: undefined,
  lightbox: 'fancybox',
  Snackbar: undefined,
  source: {
    justifiedGallery: {
      js: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery@2/dist/fjGallery.min.js',
      css: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery@2/dist/fjGallery.min.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isAnchor: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'DiceCTF2022 Write Up',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2022-05-05 10:46:42'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
    const detectApple = () => {
      if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
    })(window)</script><meta name="generator" content="Hexo 5.4.1"></head><body><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src="/img/head.jpg" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="sidebar-site-data site-data is-center"><a href="/archives/"><div class="headline">Articles</div><div class="length-num">25</div></a><a href="/tags/"><div class="headline">Tags</div><div class="length-num">28</div></a><a href="/categories/"><div class="headline">Categories</div><div class="length-num">7</div></a></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> Home</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="not-top-img" id="page-header"><nav id="nav"><span id="blog_name"><a id="site-name" href="/">Rec|rEc|reC</a></span><div id="menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> Home</span></a></div></div><div id="toggle-menu"><a class="site-page"><i class="fas fa-bars fa-fw"></i></a></div></div></nav></header><main class="layout" id="content-inner"><div id="post"><div id="post-info"><h1 class="post-title">DiceCTF2022 Write Up</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">Created</span><time class="post-meta-date-created" datetime="2022-02-07T06:30:00.000Z" title="Created 2022-02-07 14:30:00">2022-02-07</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">Updated</span><time class="post-meta-date-updated" datetime="2022-05-05T02:46:42.292Z" title="Updated 2022-05-05 10:46:42">2022-05-05</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/ctf/">ctf</a><i class="fas fa-angle-right post-meta-separator"></i><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/ctf/Write-Up/">Write Up</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title="DiceCTF2022 Write Up"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">Post View:</span><span id="busuanzi_value_page_pv"></span></span></div></div></div><article class="post-content" id="article-container"><p>DiceCTF2022</p>
<p>假期摸鱼，记录解题思路与复现情况</p>
<span id="more"></span>

<h2 id="Crypto"><a href="#Crypto" class="headerlink" title="Crypto"></a><strong>Crypto</strong></h2><p><a target="_blank" rel="noopener" href="https://blog.y011d4.com/20220207-dicectf-writeup/#crypto">DiceCTF wp by y011d4</a></p>
<h3 id="babyrsa"><a href="#babyrsa" class="headerlink" title="babyrsa"></a><strong>babyrsa</strong></h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># generate.py</span></span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> getPrime, bytes_to_long, long_to_bytes</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">getAnnoyingPrime</span>(<span class="params">nbits, e</span>):</span><br><span class="line">	<span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">		p = getPrime(nbits)</span><br><span class="line">		<span class="keyword">if</span> (p-<span class="number">1</span>) % e**<span class="number">2</span> == <span class="number">0</span>:</span><br><span class="line">			<span class="keyword">return</span> p</span><br><span class="line"></span><br><span class="line">nbits = <span class="number">128</span></span><br><span class="line">e = <span class="number">17</span></span><br><span class="line"></span><br><span class="line">p = getAnnoyingPrime(nbits, e)</span><br><span class="line">q = getAnnoyingPrime(nbits, e)</span><br><span class="line"></span><br><span class="line">flag = <span class="string">b&quot;dice&#123;???????????????????????&#125;&quot;</span></span><br><span class="line"></span><br><span class="line">N = p * q</span><br><span class="line">cipher = <span class="built_in">pow</span>(bytes_to_long(flag), e, N)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;N = <span class="subst">&#123;N&#125;</span>&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;e = <span class="subst">&#123;e&#125;</span>&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;cipher = <span class="subst">&#123;cipher&#125;</span>&quot;</span>)</span><br><span class="line"><span class="comment"># N = 57996511214023134147551927572747727074259762800050285360155793732008227782157</span></span><br><span class="line"><span class="comment"># e = 17</span></span><br><span class="line"><span class="comment"># cipher = 19441066986971115501070184268860318480501957407683654861466353590162062492971</span></span><br></pre></td></tr></table></figure>
<p>给出e,c,n其中e与$\phi(n)$不互素</p>
<p><strong>思路：</strong></p>
<p>n规模较小，暴力分解后检验发现$gcd(e, \phi(n) )=e$</p>
<p>经典AMM开根crt合并，筛选解空间得到flag</p>
<p>对不起，我选择f.roots()</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env sage</span></span><br><span class="line"><span class="keyword">from</span> babyrsa <span class="keyword">import</span> e,cipher,p,q</span><br><span class="line"><span class="comment"># factor N before solving</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">nth_solve</span>(<span class="params">n,c,p</span>):</span><br><span class="line">    R.&lt;x&gt;=PolynomialRing(GF(p))</span><br><span class="line">    f=x^n-c</span><br><span class="line">    f=f.monic()</span><br><span class="line">    <span class="keyword">return</span> f.roots()</span><br><span class="line"></span><br><span class="line">m1=nth_solve(e,cipher,p)</span><br><span class="line">m2=nth_solve(e,cipher,q)</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> m1:</span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> m2:</span><br><span class="line">        m=crt([i[<span class="number">0</span>],j[<span class="number">0</span>]],[p,q])</span><br><span class="line">        m=long_to_bytes(m)</span><br><span class="line">        <span class="keyword">if</span> <span class="string">b&#x27;dice&#123;&#x27;</span> <span class="keyword">in</span> m:exit(<span class="built_in">print</span>(m))</span><br><span class="line"><span class="comment"># dice&#123;cado-and-sage-say-hello&#125;</span></span><br></pre></td></tr></table></figure>


<h3 id="commitment-issues"><a href="#commitment-issues" class="headerlink" title="commitment-issues"></a><strong>commitment-issues</strong></h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># scheme.py</span></span><br><span class="line"><span class="keyword">from</span> random <span class="keyword">import</span> randrange</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> getPrime, inverse, bytes_to_long, GCD</span><br><span class="line"></span><br><span class="line">flag = <span class="string">b&#x27;dice&#123;?????????????????????????&#125;&#x27;</span></span><br><span class="line">n = <span class="number">5</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_prime</span>(<span class="params">n, b</span>):</span><br><span class="line">	p = getPrime(b)</span><br><span class="line">	<span class="keyword">while</span> GCD(p - <span class="number">1</span>, n) != <span class="number">1</span>:</span><br><span class="line">		p = getPrime(b)</span><br><span class="line">	<span class="keyword">return</span> p</span><br><span class="line"></span><br><span class="line">p = get_prime(n, <span class="number">1024</span>)</span><br><span class="line">q = get_prime(n, <span class="number">1024</span>)</span><br><span class="line">N = p*q</span><br><span class="line">phi = (p - <span class="number">1</span>)*(q - <span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">e = <span class="number">0xd4088c345ced64cbbf8444321ef2af8b</span></span><br><span class="line">d = inverse(e, phi)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">sign</span>(<span class="params">message</span>):</span><br><span class="line">	m = bytes_to_long(message)</span><br><span class="line">	<span class="keyword">return</span> <span class="built_in">pow</span>(m, d, N)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">commit</span>(<span class="params">s, key, n</span>):</span><br><span class="line">	<span class="keyword">return</span> (s + key) % N, <span class="built_in">pow</span>(key, n, N)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">reveal</span>(<span class="params">c1, c2, key, n</span>):</span><br><span class="line">	<span class="keyword">assert</span> <span class="built_in">pow</span>(key, n, N) == c2</span><br><span class="line">	<span class="keyword">return</span> (c1 - key) % N</span><br><span class="line"></span><br><span class="line">r = randrange(<span class="number">1</span>, N)</span><br><span class="line">s = sign(flag)</span><br><span class="line">c1, c2 = commit(s, r, n)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&#x27;N = <span class="subst">&#123;<span class="built_in">hex</span>(N)&#125;</span>&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&#x27;c1 = <span class="subst">&#123;<span class="built_in">hex</span>(c1)&#125;</span>&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&#x27;c2 = <span class="subst">&#123;<span class="built_in">hex</span>(c2)&#125;</span>&#x27;</span>)</span><br><span class="line"><span class="comment"># N = 0xBA8CB3257C0C83EDF4F56F5B7E139D3D6AC8ADF71618B5F16A02D61B63426C2C275CE631A0927B2725C6CC7BDBE30CD8A8494BC7C7F6601BCEE5D005B86016E79919E22DA4C431CEC16BE1EE72C056723FBBEC1543C70BFF8042630C5A9C23F390E2221BED075BE6A6AC71AD89A3905F6C706B4FB6605C08F154FF8B8E28445A7BE24CB184CB0F648DB5C70DC3581419B165414395AE4282285C04D6A00A0CE8C06A678181C3A3C37B426824A5A5528EE532BDD90F1F28B7EC65E6658CB463E867EB5280BDA80CBDB066CBDB4019A6A2305A03FD29825158CE32487651D9BFA675F2A6B31B7D05E7BD74D0F366CBFB0EB711A57E56E6DB6D6F1969D52BF1B27B</span></span><br><span class="line"><span class="comment"># c1 = 0x75240FCC256F1E2FC347F75BBA11A271514DD6C4E58814E1CB20913195DB3BD0440C2CA47A72EFEE41B0F9A2674F6F46A335FD7E54BA8CD1625DAEAAAA45CC9550C566F6F302B7C4C3A4694C0F5BB05CD461B5CA9017F2EB0E5F60FB0C65E0A67F3A1674D74990FD594DE692951D4EED32EAC543F193B70777B14E86CF8FA1927FE27535E727613F9E4CD00ACB8FAB336894CAA43AD40A99B222236AFC219397620CA766CEF2FE47D53B07E302410063EAE3D0BF0A9D67793237281E0BFDD48255B58B2C1F8674A21754CF62FAB0BA56557FA276241CE99140473483F3E5772FCB75B206B3E7DFB756005CEC2C19A3CB7FA17A4D17F5EDD10A8673607047A0D1</span></span><br><span class="line"><span class="comment"># c2 = 0xDB8F645B98F71B93F248442CFC871F9410BE7EFEE5CFF548F2626D12A81EE58C1A65096A042DB31A051904D7746A56147CC02958480F3B5D5234B738A1FB01DC8BF1DFFAD7F045CAC803FA44F51CBF8ABC74A17EE3D0B9ED59C844A23274345C16BA56D43F17D16D303BB1541EE1C15B9C984708A4A002D10188CCC5829940DD7F76107760550FAC5C8AB532FF9F034F4FC6AAB5ECC15D5512A84288D6FBE4B2D58AB6E326500C046580420D0A1B474DECA052EBD93AAA2EF972ACEBA7E6FA75B3234463A68DB78FFF85C3A1673881DCB7452390A538DFA92E7FF61F57EDF48662991B8DD251C0474B59C6F73D4A23FE9191AC8E52C8C409CF4902EEAA71714</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>魔法签名，给定e，N，同时给出$c1=s+key,c2=key^5 \pmod{N}$用于签名认证</p>
<p>赛时思路：</p>
<p>5次幂好小，可以开根(？)</p>
<p>(甚至虚心请问了队里的密码学师傅，对不起)</p>
<p><strong>思路：</strong></p>
<p>主要思想是基于m相对较小这一特征，构造方程使用coppersmith攻击求解小根。攻击分为两步</p>
<p>第一步需要求出$f=(c_1-k)^e \pmod{N}$，易知m即为该式的根。由于该多项式次数较高，考虑使用$k^5=c_2 \pmod{N}$进行约简，最终可以得到关于变量key的4次多项式结果</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Step 1</span></span><br><span class="line"></span><br><span class="line"><span class="comment">## Solution 1</span></span><br><span class="line"></span><br><span class="line">PRk.&lt;k&gt;=PolynomialRing(Zmod(N))</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">reduct</span>(<span class="params">f</span>):</span><br><span class="line">    g=f%(k^<span class="number">5</span>)</span><br><span class="line">    h=(f-g)//(k^<span class="number">5</span>)</span><br><span class="line">    <span class="keyword">return</span> c2*h+g</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">qpow</span>(<span class="params">f,e</span>):</span><br><span class="line">    res=<span class="number">1</span></span><br><span class="line">    <span class="keyword">while</span> e:</span><br><span class="line">        <span class="keyword">if</span> e%<span class="number">2</span>:</span><br><span class="line">            res=reduct(res*f)</span><br><span class="line">        f=reduct(f*f)</span><br><span class="line">        e&gt;&gt;=<span class="number">1</span></span><br><span class="line">    <span class="keyword">return</span> res</span><br><span class="line">f=qpow(PRk(c1-k),e)</span><br><span class="line"></span><br><span class="line"><span class="comment">## Solution 2</span></span><br><span class="line"></span><br><span class="line">PRk.&lt;k&gt;=PolynomialRing(Zmod(N))</span><br><span class="line">I=PRk.ideal(k^<span class="number">5</span>-c2)</span><br><span class="line">PRI=PRk.quotient_ring(I)</span><br><span class="line">f=PRI(c1-k)**e</span><br><span class="line">f=PRk(<span class="built_in">str</span>(f).replace(<span class="string">&#x27;kbar&#x27;</span>,<span class="string">&#x27;k&#x27;</span>))</span><br></pre></td></tr></table></figure>

<p>此处的约简操作与理想、商环的理论知识有关，因此可以使用第二种方案借助sage实现多项式商环求解。注意这种方法下sage会对多项式变量名进行变更，需要手动更改</p>
<p>*理想与商环知识候补</p>
<p>第二步即需要求出一组(k,m)满足</p>
<p>$$<br>\left\{<br>    \begin{array}{l}<br>        f(k,m)=(c1-k)^e-m=0 \\<br>        g(k,m)=k^5-c_2=0 \\<br>    \end{array}<br>\right.<br>\pmod{N}<br>$$</p>
<p>消去k，即可得到关于m的5次多项式，利用small_roots()函数求解小根即可。该步骤可以使用resultant实现，也可以求解Sylvester矩阵的行列式</p>
<p>在sagemath中，若两多项式相对变量均为正次数，则resultant()函数即求解Sylvester矩阵行列式，故两者等价</p>
<p>*但是复现的时候resultant()会出现报错，不是很清楚原因</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Step 2</span></span><br><span class="line"></span><br><span class="line">PRkm.&lt;k,m&gt;=PolynomialRing(Zmod(N))</span><br><span class="line">f=PRkm(f-m)</span><br><span class="line">g=PRkm(k^<span class="number">5</span>-c2)</span><br><span class="line"></span><br><span class="line"><span class="comment">## Solution 1</span></span><br><span class="line">res=f.sylvester_matrix(g,k).det()</span><br><span class="line"></span><br><span class="line"><span class="comment">## Solution 2</span></span><br><span class="line">res=f.resultant(g,k)</span><br></pre></td></tr></table></figure>

<p>*Sylvester Matrix可以根据两个多项式系数进行构造，若两多项式存在非常数的公因式，则矩阵的行列式为零</p>
<p>*small_roots()函数的epsilon参数会影响到最小根求解的范围，可能会导致无解or求解时间较长</p>
<p>完整solver如下</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env sage</span></span><br><span class="line"><span class="keyword">from</span> commitment-issues <span class="keyword">import</span> N,c1,c2,e</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">reduct</span>(<span class="params">f</span>):</span><br><span class="line">    g=f%(k^<span class="number">5</span>)</span><br><span class="line">    h=(f-g)//(k^<span class="number">5</span>)</span><br><span class="line">    <span class="keyword">return</span> c2*h+g</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">qpow</span>(<span class="params">f,e</span>):</span><br><span class="line">    res=<span class="number">1</span></span><br><span class="line">    <span class="keyword">while</span> e:</span><br><span class="line">        <span class="keyword">if</span> e%<span class="number">2</span>:</span><br><span class="line">            res=reduct(res*f)</span><br><span class="line">        f=reduct(f*f)</span><br><span class="line">        e&gt;&gt;=<span class="number">1</span></span><br><span class="line">    <span class="keyword">return</span> res</span><br><span class="line"></span><br><span class="line">PRk.&lt;k&gt;=PolynomialRing(Zmod(N))</span><br><span class="line">I=PRk.ideal(k^<span class="number">5</span>-c2)</span><br><span class="line">PRI=PRk.quotient_ring(I)</span><br><span class="line">f=PRI(c1-k)**e</span><br><span class="line">f=PRk(<span class="built_in">str</span>(f).replace(<span class="string">&#x27;kbar&#x27;</span>,<span class="string">&#x27;k&#x27;</span>))</span><br><span class="line"></span><br><span class="line">PRkm.&lt;k,m&gt;=PolynomialRing(Zmod(N))</span><br><span class="line">f=PRkm(f-m)</span><br><span class="line">g=PRkm(k^<span class="number">5</span>-c2)</span><br><span class="line">res=f.sylvester_matrix(g,k).det()</span><br><span class="line"></span><br><span class="line">PRm.&lt;m&gt;=PolynomialRing(Zmod(N))</span><br><span class="line">res=PRm(res).monic()</span><br><span class="line">ans=<span class="built_in">int</span>(res.small_roots(epsilon=<span class="number">0.05</span>)[<span class="number">0</span>])</span><br><span class="line"><span class="built_in">print</span>(ans.to_bytes(<span class="number">31</span>,<span class="string">&#x27;big&#x27;</span>))</span><br><span class="line"><span class="comment"># dice&#123;wh4t!!-wh0_g4ve_u-thE-k3y&#125;</span></span><br></pre></td></tr></table></figure>

<h3 id="rejected-re"><a href="#rejected-re" class="headerlink" title="rejected(re)"></a><strong>rejected(re)</strong></h3><p><a target="_blank" rel="noopener" href="https://github.com/Rechn0/Rechn0.github.io/tree/gh-pages/DiceCTF2022/rejected.zip">Problem</a>: 随机数产生系统，可以设定模数</p>
<p>赛时思路：</p>
<p>从前基本没有分析过在线的题目，比较没有经验。</p>
<p>分析发现系统底层是64bitLFSR，每次会取32bit产生随机数，系统不断迭代直到产生小于截断界限的随机数。然而，我们能够得到的回显只有产生该随机数使用的轮数。</p>
<p>分析发现系统截断会由指定的模数产生，故构造模数N可以影响到截断的效果。赛时考虑到N=pow(2,30)+1，此时cutoff=pow(2,31)+2，可以区分最高位为0/1的状态？</p>
<p>一方面是想的不够深入，另一方面通过这些离散bit也不太会恢复LFSR的前继状态。随缘复现，原地留坑</p>
<hr>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">Author: </span><span class="post-copyright-info"><a href="https://rechn0.github.io">Rec</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">Link: </span><span class="post-copyright-info"><a href="https://rechn0.github.io/2022/02/07/2022-02-07-ctf-wp-DiceCTF2022/">https://rechn0.github.io/2022/02/07/2022-02-07-ctf-wp-DiceCTF2022/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">Copyright Notice: </span><span class="post-copyright-info">All articles in this blog are licensed under <a target="_blank" rel="noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0/">CC BY-NC-SA 4.0</a> unless stating additionally.</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/RSA/">RSA</a><a class="post-meta__tags" href="/tags/FSR/">FSR</a></div><div class="post_share"><div class="social-share" data-image="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/social-share.js/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/gh/overtrue/share.js@master/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/2022/02/07/2022-02-07-ctf-crypto-blockcipher/"><img class="prev-cover" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">Previous Post</div><div class="prev_info">Blockcipher Crypto</div></div></a></div><div class="next-post pull-right"><a href="/2022/01/16/2022-01-16-ctf-crypto-prac-ctfshow/"><img class="next-cover" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">Next Post</div><div class="next_info">CTFshow Crypto</div></div></a></div></nav></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="is-center"><div class="avatar-img"><img src="/img/head.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info__name">Rec</div><div class="author-info__description">Can you hear me?</div></div><div class="card-info-data site-data is-center"><a href="/archives/"><div class="headline">Articles</div><div class="length-num">25</div></a><a href="/tags/"><div class="headline">Tags</div><div class="length-num">28</div></a><a href="/categories/"><div class="headline">Categories</div><div class="length-num">7</div></a></div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>Catalog</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#Crypto"><span class="toc-text">Crypto</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#babyrsa"><span class="toc-text">babyrsa</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#commitment-issues"><span class="toc-text">commitment-issues</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#rejected-re"><span class="toc-text">rejected(re)</span></a></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>Recent Post</span></div><div class="aside-list"><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2022/05/12/2022-05-12-ctf-wp-securinet/" title="Securinet CTF 2022 Quals&amp;Final Write Up">Securinet CTF 2022 Quals&amp;Final Write Up</a><time datetime="2022-05-12T14:14:34.518Z" title="Updated 2022-05-12 22:14:34">2022-05-12</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2022/05/12/2022-05-11-ctf-crypto-prac-cryptohack/" title="Crypto Hack">Crypto Hack</a><time datetime="2022-05-12T13:52:13.866Z" title="Updated 2022-05-12 21:52:13">2022-05-12</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2022/04/11/2022-04-11-ctf-wp-recently/" title="Recently Write Ups -April">Recently Write Ups -April</a><time datetime="2022-05-12T07:42:29.513Z" title="Updated 2022-05-12 15:42:29">2022-05-12</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/1984/03/11/1984-03-11-ebook-optional-1/" title="Courses Notes I">Courses Notes I</a><time datetime="2022-05-06T14:24:10.893Z" title="Updated 2022-05-06 22:24:10">2022-05-06</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2022/02/22/2022-02-22-ctf-wp-WestLake2021/" title="西湖论剑2021 Write Up">西湖论剑2021 Write Up</a><time datetime="2022-05-05T02:49:50.068Z" title="Updated 2022-05-05 10:49:50">2022-05-05</time></div></div></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><div class="copyright">&copy;2022 By Rec</div><div class="framework-info"><span>Framework </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>Theme </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div><div class="footer_custom_text">I can hear you.</div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="Read Mode"><i class="fas fa-book-open"></i></button><button id="hide-aside-btn" type="button" title="Toggle between single-column and double-column"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="Setting"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="Table Of Contents"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="Back To Top"><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.umd.js"></script><div class="js-pjax"><script>if (!window.MathJax) {
  window.MathJax = {
    tex: {
      inlineMath: [ ['$','$'], ["\\(","\\)"]],
      tags: 'ams'
    },
    chtml: {
      scale: 1.2
    },
    options: {
      renderActions: {
        findScript: [10, doc => {
          for (const node of document.querySelectorAll('script[type^="math/tex"]')) {
            const display = !!node.type.match(/; *mode=display/)
            const math = new doc.options.MathItem(node.textContent, doc.inputJax[0], display)
            const text = document.createTextNode('')
            node.parentNode.replaceChild(text, node)
            math.start = {node: text, delim: '', n: 0}
            math.end = {node: text, delim: '', n: 0}
            doc.math.push(math)
          }
        }, ''],
        insertScript: [200, () => {
          document.querySelectorAll('mjx-container:not\([display]\)').forEach(node => {
            const target = node.parentNode
            if (target.nodeName.toLowerCase() === 'li') {
              target.parentNode.classList.add('has-jax')
            } else {
              target.classList.add('has-jax')
            }
          });
        }, '', false]
      }
    }
  }
  
  const script = document.createElement('script')
  script.src = 'https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js'
  script.id = 'MathJax-script'
  script.async = true
  document.head.appendChild(script)
} else {
  MathJax.startup.document.state(0)
  MathJax.texReset()
  MathJax.typeset()
}</script></div><script defer="defer" id="ribbon" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/dist/canvas-ribbon.min.js" size="150" alpha="0.6" zIndex="-1" mobile="true" data-click="false"></script><script id="click-heart" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/dist/click-heart.min.js" async="async" mobile="true"></script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div></body></html>